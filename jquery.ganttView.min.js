"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){function e(e){function a(){n.each(function(){var e=t(this).css({position:"relative",overflow:"hidden"}),a=t("<div>",{class:"ganttview"}).css("padding-right",o.slideWidth);new i(a,o).render(),e.append(a),new r(e,o).apply(),setTimeout(function(){$(".ganttview-table-container").css({"min-height":$(".ganttview-slide-container").height()}),o.fixTop&&$(".ganttview-table-container").css({height:$(".ganttview-slide-container").height(),position:"relative",overflow:"auto"})},60)})}var n=this,l={showWeekends:!0,fixTop:!1,tilteName:"甘特图",titleNameSize:14,titleHeight:40,blockTitle:"停电时长 ",dateModel:!0,minGap:9e5,headerData:function(){for(var t=[],e=0;e<96;e++)t.push(Math.floor(e/4)+"时"+e%4*15+"分");return t}(),times:1,cellWidth:40,blockHeight:20,blockBgColor:"#e4c846",headerHeight:34,headerSumHeight:24,animate:!1,ghost:!1,gridcellHeight:32,blockTextColor:"#aaa",slideWidth:"100%",slideMinWidth:300,behavior:{clickable:!1,draggable:!1,resizable:!1,contextMenuable:!1},leftGridItemsShowWord:[],leftGridSeriesShowWord:[],gridCss:{},ganttviewSlideContainerCss:{},onContextmenuText:"我是右键",gridItemCss:{},gridSeriesCss:{},ganttTitleCss:{"text-align":"left","padding-left":"10px"},gridTitleNameCss:{},ganttDaysCss:{},ganttGridCellsCss:{},gridevtheaderCss:{},grideLeftBottomCss:{backgroundColor:"#fff",fontSize:"12px"},overText:"数据超出",grideRightTopCss:{backgroundColor:"#eaeaea",fontSize:"12px"},vtHeaderLBValue:"表格数据",vtHeaderRTValue:"甘特图",disabledColor:"#d0d0d0"};l.times=l.headerData.length,e.headerData&&e.headerData.length&&(e.times=e.headerData.length,l.headerData=[]);var o=t.extend(!0,l,e);if(o.data)a();else{if(!o.dataUrl)throw"甘特图无数据";t.getJSON(o.dataUrl,function(t){o.data=t,a()})}}function a(t,e){if("setSlideWidth"==t){var a=$("div.ganttview",this);a.each(function(){var t=$("div.ganttview-vtheader",a).outerWidth();$(a).width(t+e+1),$("div.ganttview-slide-container",this).width(e)})}}t.fn.ganttView=function(){var i=Array.prototype.slice.call(arguments);if(1==i.length&&"object"==_typeof(i[0]))e.call(this,i[0]);else{if(2!=i.length||"string"!=typeof i[0])throw"数据格式不正确！";a.call(this,i[0],i[1])}setTimeout(function(){function e(){var e=t(this).scrollTop();t(".ganttview-grid-container-wrap").unbind("scroll").scrollTop(e),t(".ganttview-vtheader-fixed-top").css("top",e);var a=+t(".ganttview-vtheader-fixed-bottom").attr("table-height")+e-10+"px";t(".ganttview-vtheader-fixed-bottom").css("top",a)}function a(){var e=t(this).scrollTop(),a=t(this).scrollLeft();t(".ganttview-table-container").unbind("scroll").scrollTop(e),t(".ganttview-vtheader-fixed-top").css("top",e);var i=+t(".ganttview-vtheader-fixed-bottom").attr("table-height")+e-10+"px";t(".ganttview-vtheader-fixed-bottom").css("top",i),t(".ganttview-hzheader").css("left",-a)}t(".ganttview-table-container").scroll(e),t(".ganttview-grid-container-wrap").scroll(a),t(".ganttview-table-container").mouseleave(function(){t(".ganttview-table-container").unbind("scroll",e)}),t(".ganttview").on("mousemove",".ganttview-table-container",function(){t(".ganttview-table-container").scroll(e)}),t(".ganttview-grid-container-wrap").mousemove(function(){t(".ganttview-grid-container-wrap").scroll(a)}),t(".ganttview-grid-container-wrap").mouseleave(function(){t(".ganttview-grid-container-wrap").unbind("scroll",a)}),setTimeout(function(){t(".ganttview-table-container").bind("scroll",e),t(".ganttview-grid-container-wrap").bind("scroll",a)},700)},10)};var i=function(e,a){function i(){l(e,a.data,a.cellHeight,a);var i=t("<div>",{class:"ganttview-slide-container",css:{width:a.slideWidth,"min-width":a.slideMinWidth}}).css(a.ganttviewSlideContainerCss);a.fixTop&&i.css("overflow","hidden"),o(i,a);var r=d(i,a);s(i,a,r),h(i,a),e.append(i),v(e.parent())}function r(t){return/^<([a-z]+)([^<]+)*(?:>(.*)<\/\1>|\s+\/>)$/.test(t)?(console.log("是标签"),$(t).text()):t}function l(e,a,i,n){var l=(n.bodyHeight,n.headerSumHeight,n.headerHeight,n.titleHeight,t("<div>",{class:"ganttview-table-container"})),o=t("<table>",{class:"ganttview-vtheader ganttview-vtheader-show"}).css(n.gridCss),d=t("<table>",{class:"ganttview-vtheader ganttview-vtheader-fixed-top"}).css({position:"absolute",zIndex:99});n.headerSumHeight&&n.headerSumData&&n.headerSumData.length&&n.headerSumHeight;var s=t("<div>",{class:"ganttview-vtheader-top"}).css(n.gridevtheaderCss).append(n.vtheaderText||"");o.append(s);var h=0,c=t("<tr>",{class:"ganttview-left-header-title-hidden"}),g=t("<tr>",{class:"ganttview-left-header-title"});d.append(c),o.append(g);for(var h=(n.leftGridItemsShowWord.length||0)+(n.leftGridSeriesShowWord.length||0),v=0,p="",f="",w=n.headerSumHeight+n.headerHeight+n.titleHeight+"px",m=0;m<n.leftGridItemsShowWord.length;m++){var b=100/h;v++,n.leftGridItemsShowWord[m]&&n.leftGridItemsShowWord[m].width&&(b=n.leftGridItemsShowWord[m].width);var u=w;n.fixTop&&(u=0),p+="<td class='ganttview-left-header-title-div' col-num-item='"+v+"' style='height:"+u+";line-height: "+u+"px;width:"+b+"'>"+n.leftGridItemsShowWord[m].text+"</td>",f+="<td class='ganttview-left-header-title-div' col-num-item='"+v+"' style='height:"+w+";line-height: "+w+";width:"+b+"'>"+n.leftGridItemsShowWord[m].text+"</td>"}for(var k=0;k<n.leftGridSeriesShowWord.length;k++){var b=100/h;v++,n.leftGridSeriesShowWord[m]&&n.leftGridSeriesShowWord[m].width&&(b=n.leftGridSeriesShowWord[m].width);var u=w;n.fixTop&&(u=0),p+="<td class='ganttview-left-header-title-div' col-num-item='"+v+"' style='height:"+u+";line-height: "+u+"px;width:"+b+"'>"+n.leftGridSeriesShowWord[k].text+"</td>",f+="<td class='ganttview-left-header-title-div' col-num-item='"+v+"' style='height:"+w+";line-height: "+w+";width:"+b+"'>"+n.leftGridSeriesShowWord[k].text+"</td>"}c.append(f),g.append(p);for(var x=0;x<a.length;x++){var S=t("<tr>",{class:"ganttview-vtheader-item"}).attr({title:a[x].title,id:a[x].id});0==x&&S.addClass("ganttview-vtheader-item-first");for(var T=0,u=0;u<n.leftGridItemsShowWord.length;u++){T++;var C=n.leftGridItemsShowWord[u].showWord,b=n.leftGridItemsShowWord[u].width||"",y="";1==T&&(y="ganttview-vtheader-item-name-first");var W=a[x][C]||" ",H=a[x].series.length*n.gridcellHeight-1;S.append(t("<td>",{class:"ganttview-vtheader-item-name "+y}).append(W).css({"line-height":H+"px",height:H+"px",width:100/h+"%"}).attr({title:r(W),"col-num-item":T}))}for(var G=0;G<n.leftGridSeriesShowWord.length;G++){T++;for(var C=n.leftGridSeriesShowWord[G].showWord,b=n.leftGridSeriesShowWord[G].width||"",D=t("<td>",{class:"ganttview-vtheader-series"}).attr("col-num-series",T).css("width",100/h+"%"),M=0;M<a[x].series.length;M++){var z=a[x].series[M][C]||"",N=t("<div>",{class:"ganttview-vtheader-series-name"}).css({height:n.gridcellHeight+"px","line-height":n.gridcellHeight+"px"}).append(z).attr({title:r(z)});D.append(N)}S.append(D),o.append(S)}}n.fixTop&&(l.append(d),o.css({marginTop:n.headerSumHeight+n.headerHeight+n.titleHeight})),l.append(o),e.append(l),setTimeout(function(){n.gridSeriesCss&&$(".ganttview-vtheader-series-name").css(n.gridSeriesCss),n.gridItemCss&&$(".ganttview-vtheader-item-name ").css(n.gridItemCss),n.gridTitleNameCss&&$(".ganttview-left-header-title-div").css(n.gridTitleNameCss||{})},20)}function o(e,a){var i=t("<div>",{class:"ganttview-hzheader"});a.fixTop&&i.css({position:"absolute"});for(var r=t("<div>",{class:"ganttview-hzheader-title"}).html(a.tilteName).css({height:a.titleHeight+"px",lineHeight:a.titleHeight+"px","font-size":a.titleNameSize+"px"}),n=t("<div>",{class:"ganttview-hzheader-quarters"}),l=a.times,o=0;o<a.headerData.length;o++)n.append(t("<div>",{class:"ganttview-hzheader-day"}).css({width:a.cellWidth+"px",height:a.headerHeight+"px",lineHeight:a.headerHeight+"px"}).html(a.headerData[o]));if(r.css("width",l*a.cellWidth+"px"),n.css("width",l*a.cellWidth+"px"),a.titleHeight&&i.append(r),a.headerSumData&&a.headerSumData.length){for(var d=t("<div>",{class:"ganttview-hzheader-hours"}),o=0;o<a.headerSumData.length;o++)d.append(t("<div>",{class:"ganttview-hzheader-hour"}).css({width:l*a.cellWidth/a.headerSumData.length+"px",height:"100%",lineHeight:a.headerSumHeight+"px"}).html(a.headerSumData[o]));d.css({width:l*a.cellWidth+"px",height:a.headerSumHeight}),i.append(d)}i.append(n),e.append(i),setTimeout(function(){a.ganttTitleCss&&$(".ganttview-hzheader-title").css(a.ganttTitleCss),a.ganttDaysCss&&$(".ganttview-hzheader-day ").css(a.ganttDaysCss)},20)}function d(e,a){var a=a||{data:[]},i=t("<div>",{class:"ganttview-grid"}),r=t("<div>",{class:"ganttview-grid-row"}),n=t("<div>",{class:"ganttview-grid-container-wrap"}),l=a.headerSumHeight+a.headerHeight+a.titleHeight,o=t("<div>",{class:"ganttview-grid-container"}).css({overflow:"auto",marginTop:"-1px"});a.fixTop&&o.css({});for(var d=1;d<=a.times;d++){var s=t("<div>",{class:"ganttview-grid-row-cell"}).css({height:a.gridcellHeight+"px",width:a.cellWidth+"px"});r.append(s)}var h=a.times*a.cellWidth;r.css("width",h+"px"),i.css("width",h+"px"),o.css("width",h+"px");for(var d=0;d<a.data.length;d++)for(var c=0;c<a.data[d].series.length;c++)i.append(r.clone());return o.append(i),a.fixTop?(n.append(o),n.css({"margin-top":l,height:a.bodyHeight,overflow:"auto"}),e.append(n)):e.append(o),setTimeout(function(){a.ganttGridCellsCss&&$(".ganttview-grid-row-cell").css(a.ganttGridCellsCss)},20),o}function s(e,a,i){for(var r=a.data,n=a.times*a.cellWidth,l=t("<div>",{class:"ganttview-blocks"}).css("width",n+"px"),o=0;o<r.length;o++)for(var d=0;d<r[o].series.length;d++)l.append(t("<div>",{class:"ganttview-block-container"}).css("height",a.gridcellHeight+"px"));i.append(l)}function h(e,a){for(var i=t("div.ganttview-blocks div.ganttview-block-container",e),r=0,l=a.headerData.length,o=0;o<a.data.length;o++)for(var d=0;d<a.data[o].series.length;d++){var s,h,v,p,f,w=a.data[o].series[d];if(a.dateModel){if(w.start<1e3||w.end<1e3)throw"请确定起止数据是否为时间!";if(s=new Date(w.start),h=new Date(w.end),s.getTime(),(new Date).getTime(),h.getTime()<0)throw"结束时间数据过小:"+JSON.stringify(w);if(s.getTime()>h.getTime())throw"起始时间大于结束时间："+JSON.stringify(w);var m=n.quartersBetween(c(s),h,a);p=n.quartersBetween(c(s),s,a),p<l&&(l=p),v=m-p,f=(w.name||"")+" "+w.start.toTimeString().split(" ")[0]+" 至 "+w.end.toTimeString().split(" ")[0]+"，"+a.blockTitle+" "+parseInt(v/4)+"小时"+v%4/4*60+"分钟"}else{if(s=w.start,h=w.end,a.minGap>0){if(s>h)throw"开始数据大于结束的数据:"+JSON.stringify(w);if(s<a.headerData[0]||h>a.headerData[a.headerData.length-1])throw"开始数据或者结束的数据不在允许范围内:"+JSON.stringify(w)}else{if(!(a.minGap<0))throw"minGap不能设置为0！";if(s<h)throw"开始数据小于结束的数据:"+JSON.stringify(w);if(s>a.headerData[0]||h<a.headerData[a.headerData.length-1])throw"开始数据或者结束的数据不在允许范围内:"+JSON.stringify(w)}v=(h-s)/a.minGap,p=(s-a.headerData[0])/a.minGap,p<l&&(l=p),f=w.name+", 从 "+w.start+" 至 "+w.end+"，总计"+Math.abs(h-s)}a.blockHeight>a.gridcellHeight-4&&(a.blockHeight=a.gridcellHeight-4);var b=t("<div>",{class:"ganttview-block",name:w.name,title:f,css:{width:v*a.cellWidth-6-2>0?v*a.cellWidth-6-2:a.cellWidth-8+"px","background-color":a.blockBgColor,color:a.blockTextColor,"margin-left":p*a.cellWidth+2+"px",height:a.blockHeight+"px",marginTop:(a.gridcellHeight-a.blockHeight-2)/2+"px"}}).unbind("mousedown").bind("contextmenu",function(t){return!!a.behavior.contextMenuable&&($("#blockRightMenu").remove(),$(this).attr("isRightMenuCLick","1"),$("body").append('<span id="blockRightMenu" style="padding:2px 10px;display:inline-block;border:1px solid #333;min-width: 60px;background-color: #ea6a6a;color:#fff;cursor:pointer;border-radius: 2px;position: absolute;top:'+(t.pageY+6)+"px; left:"+(t.pageX+10)+'px;z-index: 1001;">'+a.onContextmenuText+"</span>"),a.contextmenuCss&&setTimeout(function(){$("#blockRightMenu").css(a.contextmenuCss)},0),t.preventDefault(),!1)});if("false"!=w.contextMenuable&&0!=w.contextMenuable||b.unbind("contextmenu"),0==v&&(v="无"),0==w.clickable&&(b.attr("my-clickable",!1),b.css("background-color",a.disabledColor)),0==w.draggable&&(b.attr("my-draggable",!1),b.css("background-color",a.disabledColor)),0==w.resizable&&(b.attr("my-resizable",!1),b.css("background-color",a.disabledColor)),w.BgColor&&b.css("background-color",w.BgColor),w.color&&b.css("color",w.color),a.setBlockText){var u=a.setBlockText(v)||"";b.append(t("<div>",{class:"ganttview-block-text"}).html(u).attr("title",u))}else b.append(t("<div>",{class:"ganttview-block-text"}).html(v).attr("title",v));m>a.headerData.length&&b.append("<span class='overflow-text' style='float:right;color:"+a.blockTextColor+";font-size: 12px;' title='"+a.overText+"'>"+a.overText+" <span style='font-size: 14px;'>→ </span> <span>"),t(i[r]).append(b),g(b,a.data[o],w),a.blockTitleCallback&&(f=a.blockTitleCallback(b.data("block-data"))||f,b.attr("title",f)),r+=1}l&&setTimeout(function(){$(".ganttview-grid-container-wrap").animate({scrollLeft:l*a.cellWidth-1})},300),$(window).click(function(t){var t=t||window.event,e=t.target;if("blockRightMenu"==$(e).attr("id")&&a.behavior.onContextmenu){var i=$(".ganttview-block[isRightMenuCLick=1]").data("block-data");i.method="onContextmenuClick",a.behavior.onContextmenu(i,$(".ganttview-block[isRightMenuCLick=1]")),$(".ganttview-block[isRightMenuCLick=1]").removeAttr("isRightMenuCLick")}return $("#blockRightMenu").remove(),t.preventDefault(),!1})}function c(t){var e=t.clone();return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e}function g(e,a,i){var r={id:a.id,name:a.name};t.extend(r,i),e.data("block-data",r),e.data("block-data").blockName=e.data("block-data").blockName||e.attr("name"),e.data("block-data").blockQuarters=e.data("block-data").blockQuarters||e.find(".ganttview-block-text").html(),e.data("block-data").blockTime=e.data("block-data").blockTime||(e.attr("title")?e.attr("title").split("停电时长 ")[1]:""),e.data("block-data").blockTitle=e.data("block-data").blockTitle||e.attr("title")}function v(e){t("div.ganttview-grid-row div.ganttview-grid-row-cell:last-child",e).addClass("last"),t("div.ganttview-hzheader-days div.ganttview-hzheader-day:last-child",e).addClass("last"),t("div.ganttview-hzheader-months div.ganttview-hzheader-month:last-child",e).addClass("last")}return{render:i}},r=function(e,a){function i(){a.behavior.clickable&&r(e,a.behavior.onClick,a),a.behavior.resizable&&n(e,a.cellWidth,a.behavior.onResize,a),a.behavior.draggable&&l(e,a.cellWidth,a.behavior.onDrag,a)}function r(e,a,i){t("div.ganttview-block",e).on("click",function(){var e=t(this).data("block-data");e.method="click",a&&"false"!=$(this).attr("my-clickable")?a(e,t(this)):$(this).attr("my-clickable")})}function n(e,a,i,r){t("div.ganttview-block[my-resizable!=false]",e).resizable({grid:a,handles:"e,w",ghost:r.ghost,maxWidth:a*r.times*2,minWidth:0,animate:r.animate,stop:function(){var n=t(this);d(e,n,a,r);var l=t(this).data("block-data");l.method="resize",i&&i(l,n)}})}function l(e,a,i,r){t("div.ganttview-block[my-draggable!=false]",e).draggable({axis:"x",grid:[a,a],animate:r.animate,ghost:r.ghost,stop:function(){var n=t(this);d(e,n,a,r);var l=t(this).data("block-data");l.method="drag",i&&i(l,n)}})}function o(t){var e=t.clone();return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e}function d(e,a,i,r){var n=t("div.ganttview-grid-container-wrap",e),l=n.scrollLeft(),d=a.offset().left-n.offset().left-1+l;if(d<=0&&(d=0,a.css("margin-left",0).css("left",0)),r.dateModel){var s=Math.round(d/i),h=o(a.data("block-data").start);a.data("block-data").start=new Date(h.getTime()+s*r.minGap);var c=a.outerWidth(),g=Math.round(c/i);if(a.data("block-data").end=new Date(h.getTime()+(g+s)*r.minGap),r.setBlockText){var v=r.setBlockText(g);t("div.ganttview-block-text",a).text(v)}else t("div.ganttview-block-text",a).text(g);var p=(a.attr("name")||"")+" "+a.data("block-data").start.toTimeString().split(" ")[0]+" 至 "+a.data("block-data").end.toTimeString().split(" ")[0]+"，停电时长 "+Math.floor(g*r.minGap/36e5)+"小时"+g*r.minGap/6e4%60+"分钟";r.blockTitleCallback&&(p=r.blockTitleCallback(a.data("block-data"))||p),a.attr("title",p),a.data("block-data").blockName=a.attr("name")||"",a.data("block-data").blockTitle=p,a.data("block-data").blockQuarters=g,a.data("block-data").blockTime=Math.floor(g*r.minGap/36e5)+"小时"+g*r.minGap/6e4%60+"分钟"}else{var s=Math.round(d/i);a.data("block-data").start=r.headerData[0]+s*r.minGap;var c=a.outerWidth(),g=Math.round(c/i);if(a.data("block-data").end=r.headerData[0]+(g+s)*r.minGap,r.setBlockText){var v=r.setBlockText(g);t("div.ganttview-block-text",a).text(v)}else t("div.ganttview-block-text",a).text(g);var p=(a.attr("name")||"")+" 从 "+a.data("block-data").start+" 至 "+a.data("block-data").end+"，总计"+g;a.attr("title",p),a.data("block-data").blockName=a.attr("name")||"",a.data("block-data").blockTitle=p,a.data("block-data").blockQuarters=g}+a.css("width").replace("px","")+d>r.cellWidth*r.times-6?($(a).find(".overflow-text").length||a.css("width",r.cellWidth*r.times-6-d).append("<span class='overflow-text' style='float:right;color:"+r.blockTextColor+";font-size: 12px;'>"+r.overText+" <span style='font-size: 14px;'>→ </span> <span>"),a.css("width",r.cellWidth*r.times-6-d)):$(a).find(".overflow-text").remove(),a.css("top","").css("left","").css("position","relative").css("margin-left",d+"px")}return{apply:i}},n={endTimeOfThisDay:function(t){var e=t.clone();return e.setHours(23),e.setMinutes(59),e.setSeconds(59),e.setMilliseconds(999),new Date(e.getTime())},quartersBetween:function(t,e,a){if(!t||!e)throw"quartersBetween(start, end) 缺少起止时间!";if(t=new Date(t),e=new Date(e),t.getFullYear()<=1901)throw"数据的时间数据不正确！";if(a.minGap>0)return Math.floor((e.getTime()-t.getTime())/a.minGap);throw"opts.minGap设置有问题！"}}}(jQuery);